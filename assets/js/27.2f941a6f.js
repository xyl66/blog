(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{370:function(t,a,s){"use strict";s.r(a);var e=s(42),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("##修订历史\n| 版本 | 修订日期 | 修订者 | 修订内容 |\n| ---- | -------- | ------ | -------- |  |\n| V1   |          | 向玉龙 | 大纲     |")]),t._v(" "),s("h3",{attrs:{id:"一、背景及目的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、背景及目的"}},[t._v("#")]),t._v(" 一、背景及目的")]),t._v(" "),s("p",[t._v("在Admin管理平台项目中，一方面随着我们功能模块越来越多，需要处理的 JavaScript 代码量也呈指数级增长。我们开始遇到性能瓶颈 —— 使用 JavaScript 开发的工具通常需要很长时间（甚至是几分钟！）才能启动开发服务器，即使使用 HMR(热更新)，文件修改后的效果也需要几秒钟才能在浏览器中反映出来。如此循环往复，迟钝的反馈会极大地影响开发者的开发效率和幸福感。")]),t._v(" "),s("p",[t._v("另一方面，我们同一套代码中包含 越南(VN) 和 泰国 (TH) 两个国家，后续可能会更多，通过运行带不同参数(APP_REGION取值)的 build 命令，可以构建出对应国家的js代码。程序通过APP_REGION的取值进行条件语句判定，流入不同分支，运行各自国家独有的代码。但是，这样做的缺点是，VN网站的bundle包含了TH的代码，TH网站的bundle包含了VN的代码。这些冗余代码也会被上传到CDN上去，会被加载，条件语句却永远流入不了触发执行他们的分支。这是一种浪费。所以，我们可以将这些不需要的冗余代码排除在外。")]),t._v(" "),s("p",[t._v("综上所述，我们希望可以在开发时能够快速启动服务，更改代码能够快速刷新页面；以及打包上生产环境时可以减少冗余代码，缩减包的大小；同时加快页面到达用户端速度。")]),t._v(" "),s("h3",{attrs:{id:"二、逻辑架构设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、逻辑架构设计"}},[t._v("#")]),t._v(" 二、逻辑架构设计")]),t._v(" "),s("h4",{attrs:{id:"_2-1、开发打包由原来的wenpack迁移到vite-发布时接入webpublish系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1、开发打包由原来的wenpack迁移到vite-发布时接入webpublish系统"}},[t._v("#")]),t._v(" 2.1、开发打包由原来的wenpack迁移到vite,发布时接入webpublish系统")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/xiaobai1hao/images/raw/master/files/Admin%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%80%BB%E8%BE%91%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.jpg",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"_2-2、开发环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2、开发环境"}},[t._v("#")]),t._v(" 2.2、开发环境")]),t._v(" "),s("p",[t._v("利用浏览器原生对 ES 模块的支持特定，减少源码的编译，同时使用esbuild对依赖项进行处理，加快服务启动")]),t._v(" "),s("p",[t._v("目前我们admin基于webpack实现。使用工具抓取、处理并将我们的源码模块串联成可以在浏览器中运行的文件。\n"),s("img",{attrs:{src:"https://cn.vitejs.dev/assets/bundler.37740380.png",alt:""}})]),t._v(" "),s("p",[t._v("通过Vite进行开发。以 原生 ESM 方式提供源码，让浏览器接管了打包程序的部分工作")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cn.vitejs.dev/assets/esm.3070012d.png",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"_2-3、生产环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3、生产环境"}},[t._v("#")]),t._v(" 2.3、生产环境")]),t._v(" "),s("p",[t._v("基于rollup打包，将代码进行 tree-shaking 减少包大小、懒加载和 chunk 分割（以获得更好的缓存）。")]),t._v(" "),s("h5",{attrs:{id:"_2-4-1、babel处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1、babel处理"}},[t._v("#")]),t._v(" 2.4.1、babel处理")]),t._v(" "),s("p",[t._v("使用babel进行不同国家代码情况（注入相关标记）进行分离冗余代码。")]),t._v(" "),s("h5",{attrs:{id:"_2-4-2、tree-shaking"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-2、tree-shaking"}},[t._v("#")]),t._v(" 2.4.2、tree-shaking")]),t._v(" "),s("p",[t._v("用 tree-shaking，分离不同国家冗余代码")]),t._v(" "),s("h5",{attrs:{id:"_2-4-3、对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-3、对比"}},[t._v("#")]),t._v(" 2.4.3、对比")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("方式")]),t._v(" "),s("th",[t._v("优点")]),t._v(" "),s("th",[t._v("缺点")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("babel")]),t._v(" "),s("td",[t._v("esmodule,commonjs都适用")]),t._v(" "),s("td",[t._v("需写插件，需写注解代码入侵强")])]),t._v(" "),s("tr",[s("td",[t._v("tree-shaking")]),t._v(" "),s("td",[t._v("静态分析无用代码，使用简单便捷")]),t._v(" "),s("td",[t._v("基于esmodule,有些库不支持esmodule，webpack效果不好")])])])]),t._v(" "),s("h3",{attrs:{id:"三、减包逻辑详细设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、减包逻辑详细设计"}},[t._v("#")]),t._v(" 三、减包逻辑详细设计")]),t._v(" "),s("p",[t._v("1、设置不同国家环境变量；\n"),s("img",{attrs:{src:"https://gitee.com/xiaobai1hao/images/raw/master/files/20210830174347.png",alt:""}})]),t._v(" "),s("p",[t._v("2、设置模式；\n"),s("img",{attrs:{src:"https://gitee.com/xiaobai1hao/images/raw/master/files/20210830175522.png",alt:""}})]),t._v(" "),s("p",[t._v("3、使用环境变量区分国家；\n"),s("img",{attrs:{src:"https://gitee.com/xiaobai1hao/images/raw/master/files/20210830175534.png",alt:""}})]),t._v(" "),s("p",[t._v("4、编译后tree-shaking会自动移除无效代码；\n"),s("img",{attrs:{src:"https://gitee.com/xiaobai1hao/images/raw/master/files/20210830175547.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/xiaobai1hao/images/raw/master/files/20210830175558.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"四、遗留问题与风险预估"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、遗留问题与风险预估"}},[t._v("#")]),t._v(" 四、遗留问题与风险预估")]),t._v(" "),s("p",[t._v("可包括：")]),t._v(" "),s("p",[t._v("1、本次方案受限于时间、人力、外部因素等原因，未充分设计或者实现，可能带来的影响，以及下阶段的改进计划。")]),t._v(" "),s("p",[t._v("2、受限于外部依赖限制、硬件资源、网络等不可控条件，存在的运行和运营风险。")]),t._v(" "),s("p",[t._v("3、"),s("strong",[t._v("方案的优点缺点描述")])]),t._v(" "),s("h3",{attrs:{id:"五、附录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、附录"}},[t._v("#")]),t._v(" 五、附录")]),t._v(" "),s("p",[t._v("可包括一些附带的内容，例如引用的文档链接")]),t._v(" "),s("p",[t._v("测试/UAT 环境访问入口，测试建议")])])}),[],!1,null,null,null);a.default=r.exports}}]);